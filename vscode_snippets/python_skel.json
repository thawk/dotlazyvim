{
    "skel": {
        "prefix": "skel",
        "body": [
            "#!/usr/bin/env python",
            "# -*- coding: utf-8 -*-",
            "",
            "\"\"\"{0:描述本程序的作用}",
            "\"\"\"",
            "",
            "# Imports",
            "import argparse",
            "import logging",
            "import os",
            "import sys",
            "from distutils.dir_util import mkpath",
            "",
            "if sys.version_info[0] < 3:",
            "\timport cPickle as pickle",
            "\timport codecs",
            "\timport locale",
            "else:",
            "\timport pickle",
            "",
            "",
            "VERSION = u'\\$CURRENT_YEAR\\$CURRENT_MONTH\\$CURRENT_DATE'",
            "SCRIPT_DIR = os.path.dirname(os.path.realpath(__file__))",
            "# 存放结果的目录",
            "DEFAULT_OUTPUT_DIR = 'result'",
            "",
            "logger = logging.getLogger()",
            "",
            "",
            "def parse(args):",
            "\t\"\"\"解释输入文件",
            "",
            "\tArgs:",
            "\t\targs (Dict[string, string]): 命令行参数",
            "",
            "\tReturns (Dict[string, pd.DataFrame]): 解释结果",
            "\t\"\"\"",
            "\treturn dict()",
            "",
            "",
            "def analyze(result, args):",
            "\t\"\"\"分析解释结果",
            "",
            "\tArgs:",
            "\t\tresult (Dict[string, pd.DataFrame]): 解释结果",
            "\t\targs (Dict[string, string]): 命令行参数",
            "\t\"\"\"",
            "\tpass",
            "",
            "",
            "def load_result(pickle_file):",
            "\t\"\"\"载入解释结果",
            "",
            "\tArgs:",
            "\t\tpickle_file (string): pickle文件路径",
            "",
            "\tReturns (Dict[string, pd.DataFrame]): 解释结果",
            "\t\"\"\"",
            "\tlogger.info(u'Loading Pickle file \"%s\"...', pickle_file)",
            "",
            "\twith open(pickle_file, 'r') as _:",
            "\t\treturn pickle.load(_)",
            "",
            "\tlogger.info(u'  Done.')",
            "",
            "",
            "def export_result(pickle_file, result):",
            "\t\"\"\"导出解释结果",
            "",
            "\tArgs:",
            "\t\tpickle_file (string): pickle文件路径",
            "\t\tresult (Dict[string, pd.DataFrame]): 解释结果",
            "\t\"\"\"",
            "\tlogger.info(u'Exporting to \"%s\"...', pickle_file)",
            "",
            "\tif not os.path.exists(os.path.dirname(pickle_file)):",
            "\t\tlogger.info(u'  Creating \"%s\"...', os.path.dirname(pickle_file))",
            "\t\tmkpath(os.path.dirname(pickle_file))",
            "",
            "\twith open(pickle_file, 'w') as _:",
            "\t\tpickle.dump(result, _, pickle.HIGHEST_PROTOCOL)",
            "",
            "\tlogger.info(u'  Done.')",
            "",
            "",
            "def init_locale():",
            "\t\"\"\"初始化locale信息\"\"\"",
            "\tif sys.version_info[0] < 3:",
            "\t\treload(sys)",
            "\t\tsys.setdefaultencoding('utf8')",
            "",
            "\t\tencoding = locale.getpreferredencoding()",
            "\t\tsys.stdout = codecs.getwriter(encoding)(sys.stdout)",
            "\t\tsys.stderr = codecs.getwriter(encoding)(sys.stderr)",
            "",
            "",
            "def locale_args(args):",
            "\t\"\"\"对解释出来的命令行参数进行编码转换",
            "",
            "\tArgs:",
            "\t\targs (Dict[string, string]): 解释结果",
            "",
            "\tReturns (Dict[string, string]): 转换为unicode的解释结果",
            "\t\"\"\"",
            "\t# 对解释出来的参数进行编码转换",
            "\tfor key in args:",
            "\t\tvalue = args[key]",
            "\t\tif isinstance(value, str):",
            "\t\t\targs[key] = unicode(value, locale.getpreferredencoding()).strip()",
            "\t\telif isinstance(value, list):",
            "\t\t\targs[key] = [",
            "\t\t\t\tunicode(s, locale.getpreferredencoding()).strip()",
            "\t\t\t\tif isinstance(s, str) else s for s in value",
            "\t\t\t]",
            "",
            "\treturn args",
            "",
            "",
            "def init_logger(args):",
            "\t\"\"\"日志初始化",
            "",
            "\tArgs:",
            "\t\targs (Dict[string, string]): 命令行参数",
            "\t\"\"\"",
            "\tlog_format = u'%(asctime)s %(levelname)s %(message)s'",
            "",
            "\tif args['quiet']:",
            "\t\tlogging.basicConfig(level=logging.WARNING, format=log_format)",
            "\telif args['verbose']:",
            "\t\tlogging.basicConfig(level=logging.DEBUG, format=log_format)",
            "\telse:",
            "\t\tlogging.basicConfig(level=logging.INFO, format=log_format)",
            "",
            "",
            "def main(argv):",
            "\t\"\"\"程序主入口",
            "",
            "\tArgs:",
            "\t\targs (Dict[string, string]): 命令行参数",
            "\t\"\"\"",
            "\tinit_locale()",
            "\targs = init_args(argv)",
            "\tinit_logger(args)",
            "",
            "\tif 'load' in args and args['load']:",
            "\t\tresult = load_result(args['load'])",
            "\telse:",
            "\t\tresult = parse(args)",
            "",
            "\t\tif 'export' in args and args['export']:",
            "\t\t\texport_result(args['export'], result)",
            "",
            "\tanalyze(result, args)",
            "",
            "",
            "def init_args(argv):",
            "\t\"\"\"解释命令行参数",
            "",
            "\tArgs:",
            "\t\targv (List[string]): 命令行参数（sys.argv[1:]）",
            "",
            "\tReturns (Dict[string, string]): 解释结果",
            "\t\"\"\"",
            "\tparser = argparse.ArgumentParser(",
            "\t\tdescription=u'''\\",
            "${1:description}''')",
            "",
            "\tparser.add_argument(",
            "\t\t'-v', '--verbose', action='store_true', dest='verbose', default=False,",
            "\t\thelp=u'显示调试日志')",
            "\tparser.add_argument(",
            "\t\t'-q', '--quiet', action='store_true', dest='quiet', default=False,",
            "\t\thelp=u'只显示警告以上级别的日志')",
            "\tparser.add_argument(",
            "\t\t'--version', action='version', version=VERSION,",
            "\t\thelp=u'显示程序版本号后退出')",
            "\tparser.add_argument(",
            "\t\t'-o', '--output', action='store', dest='output_dir',",
            "\t\tdefault=DEFAULT_OUTPUT_DIR, help=u'结果存放目录')",
            "\tparser.add_argument(",
            "\t\t'--load', action='store', dest='load', metavar='PICKLE_FILE',",
            "\t\thelp=u'从pickle文件中载入数据而不是从日志中分析')",
            "\tparser.add_argument(",
            "\t\t'--export', action='store', dest='export', default=False,",
            "\t\thelp=u'保存各结果为pickle文件')",
            "\tparser.add_argument(",
            "\t\t'-c', '--concurrent', action='store', default='auto',",
            "\t\thelp=u'并发数')",
            "\t#  parser.add_argument(",
            "\t#\t   'logfile', nargs='*', help=u'日志文件路径')",
            "",
            "\targs = vars(parser.parse_args(argv))",
            "",
            "\tif sys.version_info[0] < 3:",
            "\t\targs = locale_args(args)",
            "",
            "\treturn args",
            "",
            "",
            "if __name__ == '__main__':",
            "\tmain(sys.argv[1:])"
        ],
        "description": "full skel with argparse for python2/3"
    }
}
